{% extends "faculty/dashboard.html" %} {% load static %} {% block content %}


<style>
  .contact-card-split {
    transition: all 0.25s ease;
    min-width: 280px; /* ensures enough width */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .contact-card-split:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
  }

  .contact-card-split img {
    border: 3px solid #e9ecef;
    transition: 0.3s ease;
  }

  .contact-card-split:hover img {
    border-color: var(--bs-primary);
    transform: scale(1.05);
  }

  .contact-list i {
    font-size: 1rem;
  }

  .section-title {
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #2b2d42;
  }

  .card-body {
    padding: 1.5rem;
  }

  @media (min-width: 992px) {
    .custom-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: flex-start;
    }

    .custom-grid .col {
      flex: 1 1 calc(33.333% - 1.5rem); /* 3 per row */
      max-width: calc(33.333% - 1.5rem);
    }
  }

  @media (max-width: 991px) and (min-width: 576px) {
    .custom-grid .col {
      flex: 1 1 calc(50% - 1rem);
      max-width: calc(50% - 1rem);
    }
  }
  .contact-card-split .bi-linkedin:hover {
    color: #0077b5; /* LinkedIn blue */
  }
  .contact-card-split .bi-github:hover {
    color: #333; /* GitHub gray */
  }
</style>

<div class="container my-5">
  <!-- Developer Team Section -->
  <div class="mb-5">
    <!-- Faculty Directory Section -->
    <div>
      <div class="d-flex justify-content-between align-items-center mt-4">
        <a href="{% url 'dashboard' faculty.user.username %}" class="btn mb-5 me-5" style="border-color: aqua; color: aqua; font-size: 1.15rem;">
            <i class="fa-solid fa-caret-left me-1" style="color: aqua;"></i> Back to Dashboard
        </a>
        <div class="d-flex gap-3">
          <a href="{% url 'download_research_report' %}" class="btn mb-5" style="border-color: aqua; color: aqua; font-size: 1.15rem;">
              <i class="fa-solid fa-file-pdf me-1" style="color: aqua;"></i> Download Research Report
          </a>
          <a href="{% url 'download_achievements_report' %}" class="btn mb-5" style="border-color: gold; color: gold; font-size: 1.15rem;">
            <i class="fa-solid fa-trophy me-1"></i> Achievements Report
          </a>
        </div>
        
      </div>
      <h3 class="pb-3 mb-4 section-title" style="color: #00FF85; font-size: 1.8rem; border-bottom: 1px solid #00FF85;">
        All Faculty
      </h3>
      <div class="custom-grid">
        {% for faculty in faculty_list %}
        <div class="col">
          <div class="card shadow-sm h-100 contact-card-split profile-card" style="color: white;">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-4 text-center circle">
                  <img
                    src="{{ faculty.image.url }}"
                    alt="{{ faculty.user.get_full_name }}"
                    class="rounded-circle mb-3 mb-sm-0"
                    width="100"
                    height="100"
                    style="border-color: #00FF85;"
                  />
                </div>
                <div class="col-8">
                  <h5 class="card-title mb-0 fw-semibold">
                    {{ faculty.user.get_full_name }}
                  </h5>
                  <p class="small mt-2">{{ faculty.designation }}</p>
                  <hr class="my-2" />
                  <ul class="list-unstyled text-start mb-0 contact-list">
                    <li>
                      <i class="fa-solid fa-envelope me-2" style="color: aqua;"></i>
                      <a href="mailto:{{ faculty.user.email }}" class="text-decoration-none" style="color: white;"
                        >{{ faculty.user.email }}</a
                      >
                    </li>
                    <li class="mt-2">
                      <i class="fa-solid fa-phone me-2" style="color: aqua;"></i>
                      {{ faculty.phone|default:"N/A" }}
                    </li>
                    <li>
                      <a
                        href=""
                        class="btn mt-3"
                        data-bs-toggle="modal"
                        data-bs-target="#allDocsModal"
                        data-bs-username="{{ faculty.user.username }}"
                        style="border:1px solid aqua; color: aqua; font-size: 1rem;"
                      >
                        View all Documents
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <p class="text-muted">No faculty profiles found.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="card shadow-sm rounded-lg border-0 profile-card mb-5">
    <!-- .card-body: Provides standard padding inside the card. -->
    <div class="card-body" style="border: 1px solid #00FF85; border-radius: 8px;">
      <!-- .card-title: Standard Bootstrap class for a card's title. -->
      <h2 class="card-title h5 mb-3 "  style="color: #00FF85;">
        Publications Distribution by Year
      </h2>

      <!-- 
      Chart container
      .w-100: (width: 100%) Ensures the chart container fills the card.
    -->
      <div
        class="chart-container w-100"
        style="min-height: 350px; height: auto"
      >
        <!-- 
        The Plotly HTML (graph_html) is injected here.
        The '|safe' filter is essential for rendering the raw HTML/JS.
      -->
        {{ graph_html|safe }}
      </div>
    </div>
  </div>
  <div
    class="modal fade"
    id="allDocsModal"
    tabindex="-1"
    aria-labelledby="allDocsModalLabel"
    aria-hidden="true"
  >
    <div
      class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"
    >
      <div class="modal-content profile-card" style="color: white; background-color: rgba(0, 0, 0, 0.75);">
        <div class="modal-header">
          <h5 class="modal-title" id="allDocsModalLabel" style="color: #00FF85;">All Documents</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
          <button type="button" 
            class="btn-custom-close" 
            data-bs-dismiss="modal" 
            style="position: absolute; top: 15px; right: 15px; background: transparent; border: none; font-size: 1.5rem;">
        <i class="fa-solid fa-xmark" style="color: aqua;"></i>
    </button>
        </div>
        <div class="modal-body" id="allDocsModalBody">
          <div class="text-center p-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const allDocsModal = document.getElementById("allDocsModal");
      const allDocsModalBody = document.getElementById("allDocsModalBody");

      allDocsModal.addEventListener("show.bs.modal", async function (event) {
        const button = event.relatedTarget;
        const username = button.getAttribute("data-bs-username");

        // Set to loading state
        allDocsModalBody.innerHTML =
          '<div class="text-center p-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>';

        try {
          // Fetch the tabbed HTML from our new view
          const response = await fetch(`/${username}/all-documents/`);
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          const html = await response.text();

          // Inject the loaded HTML
          allDocsModalBody.innerHTML = html;
        } catch (error) {
          console.error("Failed to fetch modal content:", error);
          allDocsModalBody.innerHTML =
            '<p class="text-danger p-4 text-center">Failed to load documents. Please try again.</p>';
        }
      });
    });
  </script>
  {% endblock content %}
</div>
