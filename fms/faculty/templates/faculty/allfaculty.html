{% extends "faculty/dashboard.html" %} {% load static %} {% block content %}

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
/>

<style>
  .contact-card-split {
    border: none;
    border-radius: 1rem;
    transition: all 0.25s ease;
    background: #fff;
    min-width: 280px; /* ensures enough width */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .contact-card-split:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
  }

  .contact-card-split img {
    border: 3px solid #e9ecef;
    transition: 0.3s ease;
  }

  .contact-card-split:hover img {
    border-color: var(--bs-primary);
    transform: scale(1.05);
  }

  .contact-list i {
    font-size: 1rem;
  }

  .section-title {
    font-weight: 600;
    letter-spacing: 0.5px;
    color: #2b2d42;
  }

  .card-body {
    padding: 1.5rem;
  }

  @media (min-width: 992px) {
    .custom-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: flex-start;
    }

    .custom-grid .col {
      flex: 1 1 calc(33.333% - 1.5rem); /* 3 per row */
      max-width: calc(33.333% - 1.5rem);
    }
  }

  @media (max-width: 991px) and (min-width: 576px) {
    .custom-grid .col {
      flex: 1 1 calc(50% - 1rem);
      max-width: calc(50% - 1rem);
    }
  }
  .contact-card-split .bi-linkedin:hover {
    color: #0077b5; /* LinkedIn blue */
  }
  .contact-card-split .bi-github:hover {
    color: #333; /* GitHub gray */
  }
</style>

<div class="container my-5">
  <!-- Developer Team Section -->
  <div class="mb-5">
    <!-- Faculty Directory Section -->
    <div>
      <h3 class="pb-3 mb-4 border-bottom section-title">All Faculty</h3>
      <div class="custom-grid">
        {% for faculty in faculty_list %}
        <div class="col">
          <div class="card shadow-sm h-100 contact-card-split">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-4 text-center">
                  <img
                    src="{{ faculty.image.url }}"
                    alt="{{ faculty.user.get_full_name }}"
                    class="rounded-circle mb-3 mb-sm-0"
                    width="100"
                    height="100"
                  />
                </div>
                <div class="col-8">
                  <h5 class="card-title mb-0 fw-semibold">
                    {{ faculty.user.get_full_name }}
                  </h5>
                  <p class="text-muted small">{{ faculty.designation }}</p>
                  <hr class="my-2" />
                  <ul class="list-unstyled text-start mb-0 contact-list">
                    <li>
                      <i class="bi bi-envelope me-2 text-primary"></i>
                      <a href="#" class="text-decoration-none text-body"
                        >{{ faculty.user.email }}</a
                      >
                    </li>
                    <li class="mt-2">
                      <i class="bi bi-telephone me-2 text-primary"></i>
                      {{ faculty.phone|default:"N/A" }}
                    </li>
                    <li>
                      <a
                        href=""
                        class="btn btn-outline-secondary mt-3"
                        data-bs-toggle="modal"
                        data-bs-target="#allDocsModal"
                        data-bs-username="{{ faculty.user.username }}"
                      >
                        View all Documents
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">
          <p class="text-muted">No faculty profiles found.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div
    class="modal fade"
    id="allDocsModal"
    tabindex="-1"
    aria-labelledby="allDocsModalLabel"
    aria-hidden="true"
  >
    <div
      class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable"
    >
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="allDocsModalLabel">All Documents</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body" id="allDocsModalBody">
          <div class="text-center p-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const allDocsModal = document.getElementById("allDocsModal");
      const allDocsModalBody = document.getElementById("allDocsModalBody");

      allDocsModal.addEventListener("show.bs.modal", async function (event) {
        const button = event.relatedTarget;
        const username = button.getAttribute("data-bs-username");

        // Set to loading state
        allDocsModalBody.innerHTML =
          '<div class="text-center p-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>';

        try {
          // Fetch the tabbed HTML from our new view
          const response = await fetch(`/${username}/all-documents/`);
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          const html = await response.text();

          // Inject the loaded HTML
          allDocsModalBody.innerHTML = html;
        } catch (error) {
          console.error("Failed to fetch modal content:", error);
          allDocsModalBody.innerHTML =
            '<p class="text-danger p-4 text-center">Failed to load documents. Please try again.</p>';
        }
      });
    });
  </script>
  {% endblock content %}
</div>
